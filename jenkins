node {

    def imgname
    imgname = "stmum0107/ngclient:${env.BUILD_NUMBER}"

    stage('Clone repository') {
        git(credentialsId: 'github', url: 'https://github.com/stcloudgate/3nglearn.git')
    }

    stage('Build image') {
      sh "docker build -t ${imgname} ."
    }

    stage('Push image') {
      withCredentials([usernameColonPassword(credentialsId: 'docker', variable: 'dockerhub')]) {
        sh 'docker login -u stmum0107 -p ${dockerhub}'
      }
      sh "docker push ${imgname}"
}

    //stage('Trigger ManifestUpdate') {
      //echo "triggering updatemanifestjob - to be coded"
      //build job: 'updatemanifest', parameters: [string(name: 'DOCKERTAG', value: env.BUILD_NUMBER)]
    //}
}

